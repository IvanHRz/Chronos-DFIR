<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronos-DFIR Web</title>
    <!-- Tabulator CSS -->
    <link href="https://unpkg.com/tabulator-tables@6.3.0/dist/css/tabulator_midnight.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://oss.sheetjs.com/sheetjs/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    <link rel="stylesheet" href="/static/chronos_v110.css?v=115">

</head>

<body>

    <div class="container">
        <header>
            <h1>Chronos-DFIR <span class="version-badge">BETA 1.1</span> <span class="version-badge"
                    style="background:var(--accent-primary); color:white;">v115</span></h1>
            <p>Advanced Forensic Artifact Timeline Explorer</p>
        </header>

        <div class="upload-section" id="drop-area">
            <form class="my-form">
                <p>Drag & Drop Artifacts (MFT, EVTX) or Reports (CSV, XLSX, TSV, JSON, Parquet, SQLite)</p>
                <input type="file" id="fileElem" accept=".evtx,.mft,.csv,.xlsx,.tsv" onchange="handleFiles(this.files)">
                <label class="button" for="fileElem">Select File</label>
            </form>
            <div id="upload-status"></div>
        </div>

        <div class="controls hidden" id="controls">
            <select id="artifact-type">
                <option value="EVTX">EVTX (Event Logs)</option>
                <option value="MFT">MFT (NTFS)</option>
            </select>
            <!-- Artifact Select -->
        </div>
        <div style="text-align: center; margin-top: 10px; margin-bottom: 10px;">
            <button id="process-btn" class="btn-primary">Process Artifact</button>
            <button id="reset-view-btn" class="btn-secondary" onclick="resetView()" style="margin-left: 10px;">Reset
                View âŸ³</button>
        </div>
    </div>

    <div id="results-area" class="hidden">
        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <!-- Toolbar -->
        <!-- Toolbar -->
        <div class="output-controls">
            <!-- Global Reset (Always Visible) -->
            <button id="reset-view-btn-toolbar" class="btn-secondary" onclick="resetView()">Reset View âŸ³</button>

            <div class="divider-vertical"></div>

            <button id="download-csv" class="btn-secondary">CSV</button>
            <button id="download-excel" class="btn-secondary">Excel</button>
            <button id="download-split" class="btn-secondary" title="Split into 100MB chunks (Zip)">Zip (Split)</button>

            <div class="divider-vertical"></div>

            <!-- Time Filter Group -->
            <div class="control-group" id="time-filter-container">
                <span class="control-group-label">Time</span>
                <input type="text" id="time-start" class="date-picker" placeholder="Start" style="width: 130px;">
                <input type="text" id="time-end" class="date-picker" placeholder="End" style="width: 130px;">
                <button id="filter-time-btn" class="btn-secondary btn-sm">Filter</button>
                <button id="clear-time-btn" class="btn-danger btn-sm" style="display:none;"
                    title="Clear Time Filter">âœ•</button>
            </div>

            <!-- Global Search -->
            <input type="text" id="global-search" class="search-input" placeholder="Global Search..."
                style="flex-grow: 1; min-width: 200px;">

            <div class="divider-vertical"></div>

            <!-- Right Aligned Group -->
            <div class="btn-group-right">

                <!-- Row Filtering & Manage Columns Group -->
                <div class="control-group" style="padding: 2px 6px; gap: 4px;">
                    <button id="filter-selection-btn" class="btn-primary">Row Filtering</button>
                    <button id="col-manager-btn" class="btn-primary">Manage Cols <i class="fas fa-columns"></i></button>

                    <!-- Hidden Actions for Manage Cols -->
                    <div id="col-manager-actions"
                        style="display:none; gap:4px; margin-left:4px; padding-left:4px; border-left:1px solid #555;">
                        <button class="btn-info btn-sm" onclick="moveSelectedColumns()"
                            title="Move Selected to Top">Top</button>
                        <button class="btn-warning btn-sm" onclick="filterSelectedColumns()"
                            title="Show Only Selected">Filter Cols</button>
                        <button class="btn-danger btn-sm" onclick="resetColumnManager()"
                            title="Clear Selection">âœ•</button>
                    </div>
                </div>

                <button id="download-ai" class="btn-ai" title="Export filtered view without empty columns">AI
                    Context</button>
                <button id="toggle-empty-cols" class="btn-secondary" title="Hide/Show columns with no data">Hide
                    Empty</button>
            </div>
        </div>

        <!-- Info Bar (Time Range & Count) -->
        <div class="output-controls"
            style="border-top: 1px solid var(--border-color); margin-top: -1px; border-radius: 0 0 var(--radius-md) var(--radius-md); font-size: 0.85rem; padding: 4px 10px; min-height: 30px;">
            <span id="record-count" style="color: var(--text-muted); margin-right: 15px;">0 Records</span>
            <span id="time-range-info" style="color: var(--accent-primary); font-weight: 500;">Time Range: N/A</span>

            <div style="flex-grow: 1;"></div>
            <label style="color: var(--text-primary); cursor: pointer; display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="log-scale-toggle"> Log Scale
            </label>
        </div>

        <!-- Chart Controls -->
        <div class="chart-controls"
            style="display: flex; justify-content: flex-end; gap: 5px; margin-bottom: 5px; padding-right: 10px;">
            <button class="btn-secondary btn-sm" onclick="downloadChartPNG()">ðŸ“· PNG</button>
            <button class="btn-secondary btn-sm" onclick="downloadChartExcel()">ðŸ“Š Excel (Data)</button>
            <button class="btn-secondary btn-sm" style="border-radius:50%; width:24px; height:24px; padding:0;"
                title="Levels: Critical(1)-Verbose(5)">?</button>
        </div>

        <!-- Timeline Chart -->
        <div id="chart-wrapper">
            <canvas id="timelineChart"></canvas>
            <div id="chart-interpretation" style="padding: 10px; color: var(--text-secondary); font-style: italic;">
            </div>
        </div>

        <div class="table-container">
            <div id="timeline-table"></div>
        </div>
    </div>

    <!-- Details Modal -->
    <div id="detail-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3 id="modal-title">Cell Details</h3>
            <pre id="modal-text"></pre>
        </div>
    </div>

    <!-- Scripts -->
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@6.3.0/dist/js/tabulator.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="/static/script.js?v=115"></script>

</body>

</html>
